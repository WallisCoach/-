<template>
    <div>
        <el-button type="primary" icon="el-icoc-edit" size="mini" @click="showEditDialog(roleId)" >编辑</el-button>

        <!-- 修改角色的对话框 -->
        <el-dialog title="修改用户"
        :visibie.sync = "editDialogVisible"
        width="50%"
        @close="editDialogClose">
            <el-form :modele="editRoleForm" :rules="roleFormRules" ref="editRoleFormRef" label-width="80px">
                <el-form-item label="角色名称" prop="roleName">
                    <el-input v-model="editRoleForm.roleName">
                    </el-input>
                </el-form-item>
                <el-form-item label="角色描述" prop="roleDesc">
                    <el-input v-model="editRoleForm.roleDesc"></el-input>
                </el-form-item>
            </el-form>
            <span slot="fotter" class="dialog-footer">
                <el-button @Click="editDialogVisible=false">取 消</el-button>
                <el-button type="primary" @click="editRole">确 定</el-button>
            </span> 
        </el-dialog>
    </div>
</template>

<script>
import {
    getRoleByIdRequest,
    editRoleRequest
} from 'network/rights'
export default {
    name:'RoleEdit',
    props:{
        roleId:{
            type:Number,
            required:true
        }
    },
    data(){
        return{
            editDialogVisible:false,
            editRoleForm:{
                roleName:'',
                roleDesc:''
            },
            roleFormRules:{
                roleName:[
                    {required: true, message:'请输入角色名称',trigger:'blur'},
                    {min:2,max:10,message:'长度需要在2到10是之间', trigger:'blur'}
                ],
                roleDesc:[
                    {required:true,messgae:'请输入角色描述',trigger:'blur'},
                    {min:3, max:20, message:'长度需要在3到20之间', trigger:'blur'}
                ],
            },
        }
    },
    methods:{
        //展示编辑角色的弹窗
        showEditDialog(id){
            this.editiDialogVisible = true;
            getRoleByIdRequest(id).then(res =>{
                let result = res.data;
                if (result.meta.status !== 200){
                    return this.alertMessage('获取角色信息失败','error');l
                }

                this.editRoleForm = result.data;
            })
        },

        //监听编辑角色的弹框的关闭事件
        editDialogClose(){
            this.$refs.editRoleFormRef.resetFields();
        },

        //点击编辑觉得弹框的‘确认’按钮提交
        editRole(){
            this.$refs.editRoleFormRef.validate(valid =>{
                if (!valid) return;
                editRoleRequeste(this.editRoleForm).then(res =>{
                    let result = res.data;
                    
                    if(result.meta.status !== 200){
                        return this.alertMessage('修改失败','error');
                    }
                    this.alertMessage('修改成功过','success');

                    //隐藏弹窗
                    this.editDialogVisible = false;

                    //重新获取角色列表
                    this.$emit('role-list');
                })
            })
        }
    }
}
</script>

<style>
.editDialog{
    display: inline-block;
    margin-right: 5px;
}

</style>